name: Frontend - Build & Test Docker Image (CI)

on:
  pull_request:
    branches: ["develop", "main"]  # Run CI when a PR targets develop or main
  workflow_dispatch:               # Allow manual runs too

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
      # 1️⃣ Checkout code
      - name: Checkout code
        uses: actions/checkout@v4

      # 2️⃣ Set up Node.js (Angular uses Node)
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18

      # 3️⃣ Install dependencies
      - name: Install dependencies
        run: |
          cd "employee frontend final"
          npm install

      # 4️⃣ Build Angular app
      - name: Build Angular app
        run: |
          cd "employee frontend final"
          npm run build --if-present

      # 5️⃣ Build Docker image for frontend
      - name: Build Docker image
        run: |
          docker build -t emp-frontend:test "./employee frontend final"

      # 6️⃣ Run frontend tests (if you have any)
      - name: Run frontend tests
        run: |
          docker run --rm emp-frontend:test sh -c "npm test || echo 'No tests defined, skipping...'"

      # 7️⃣ Success message
      - name: Success
        run: echo "✅ Frontend Docker image built and tests passed successfully!"
